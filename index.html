<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tra cá»©u Ä‘iá»ƒm THPT</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="/style.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">

  <div class="container">
    <h1 class="title">ğŸ“ Tra cá»©u Ä‘iá»ƒm thi THPT Quá»‘c Gia</h1>

    <div class="card">
      <div class="input-group">
        <input type="text" id="sbd" placeholder="Nháº­p SBD (vÃ­ dá»¥: 01000001)" class="input" />
        <button onclick="traCuu()" class="button">ğŸ” Tra cá»©u</button>
      </div>
      <pre id="result" class="result-box"></pre>
    </div>

    <div class="card">
      <h2 class="section-title">ğŸ“Š Thá»‘ng kÃª há»c sinh theo má»©c Ä‘iá»ƒm</h2>
      <canvas id="chart" height="300"></canvas>
    </div>
  </div>

  <script>
    async function traCuu() {
      const sbd = document.getElementById("sbd").value.trim();
      if (!sbd) return alert("Vui lÃ²ng nháº­p SBD.");
      const res = await fetch(`/tra-cuu?sbd=${sbd}`);
      const data = await res.text();
      document.getElementById("result").textContent = data;
    }

    fetch('/api/report')
      .then(res => res.json())
      .then(data => {
        const subjects = Object.keys(data);
        const datasets = [
          { label: ">= 8", data: [], backgroundColor: "#4caf50" },
          { label: "6 â€“ 8", data: [], backgroundColor: "#ffca28" },
          { label: "4 â€“ 6", data: [], backgroundColor: "#29b6f6" },
          { label: "< 4", data: [], backgroundColor: "#ef5350" },
        ];

        subjects.forEach(subject => {
          datasets[0].data.push(data[subject].level1);
          datasets[1].data.push(data[subject].level2);
          datasets[2].data.push(data[subject].level3);
          datasets[3].data.push(data[subject].level4);
        });

        new Chart(document.getElementById("chart"), {
          type: "bar",
          data: {
            labels: subjects,
            datasets: datasets
          },
          options: {
            responsive: true,
            plugins: {
              title: {
                display: true,
                text: "Sá»‘ há»c sinh theo má»©c Ä‘iá»ƒm tá»«ng mÃ´n",
                font: {
                  size: 18
                }
              },
              legend: {
                position: "top"
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: "Sá»‘ lÆ°á»£ng"
                }
              }
            }
          }
        });
      });
  </script>
  <div class="container">
    <h1>Top 10 thÃ­ sinh Ä‘iá»ƒm cao theo khá»‘i</h1>
    
    <button class="tab" data-group="A" onclick="showGroup('A')">Khá»‘i A</button>
    <button class="tab" data-group="A1" onclick="showGroup('A1')">Khá»‘i A1</button>
    <button class="tab" data-group="B" onclick="showGroup('B')">Khá»‘i B</button>
    <button class="tab" data-group="D" onclick="showGroup('D')">Khá»‘i D</button>

    <div id="tables"></div>
  </div>

  <script>
    let top10Data = {};

    async function fetchTop10() {
      const res = await fetch('/api/top10');
      top10Data = await res.json();
      showGroup('A');
    }

    function showGroup(group) {
      document.querySelectorAll('.tab').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.group === group);
      });

      const table = document.createElement('table');
      table.innerHTML = `
        <thead>
          <tr>
            <th>STT</th>
            <th>SBD</th>
            <th>ToÃ¡n</th>
            <th>VÄƒn</th>
            <th>Anh</th>
            <th>LÃ½</th>
            <th>HÃ³a</th>
            <th>Sinh</th>
            <th>Tá»•ng</th>
          </tr>
        </thead>
        <tbody>
          ${top10Data[group].map((s, i) => `
            <tr>
              <td>${i + 1}</td>
              <td>${s.sbd}</td>
              <td>${s.subjects.toan ?? ''}</td>
              <td>${s.subjects.ngu_van ?? ''}</td>
              <td>${s.subjects.ngoai_ngu ?? ''}</td>
              <td>${s.subjects.vat_li ?? ''}</td>
              <td>${s.subjects.hoa_hoc ?? ''}</td>
              <td>${s.subjects.sinh_hoc ?? ''}</td>
              <td><strong>${s.total}</strong></td>
            </tr>`).join('')}
        </tbody>
      `;

      const container = document.getElementById('tables');
      container.innerHTML = '';
      container.appendChild(table);
    }

    fetchTop10();
  </script>
</body>
</html>
